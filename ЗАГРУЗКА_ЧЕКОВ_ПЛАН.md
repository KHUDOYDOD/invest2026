# üìÑ –ó–∞–≥—Ä—É–∑–∫–∞ –ß–µ–∫–æ–≤ –æ–± –û–ø–ª–∞—Ç–µ - –ü–ª–∞–Ω –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## üéØ –ó–∞–¥–∞—á–∞

–î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ–∫–æ–≤/—Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:

### –î–ª—è –ë–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –ü–µ—Ä–µ–≤–æ–¥–æ–≤/–°–ë–ü:
- üìÑ –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ–∫–∞ (PDF)
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5 –ú–ë

### –î–ª—è –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã:
- üñºÔ∏è –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ (JPG, JPEG, PNG)
- üîó –ü–æ–ª–µ –¥–ª—è –∞–¥—Ä–µ—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (hash)
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5 –ú–ë

## üìã –ß—Ç–æ –ù—É–∂–Ω–æ –°–¥–µ–ª–∞—Ç—å

### 1. –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö
–ü–æ–ª–µ `payment_details` –≤ —Ç–∞–±–ª–∏—Ü–µ `deposit_requests` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (JSONB).
–ë—É–¥–µ–º —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç—É–¥–∞:
```json
{
  "method": "–°–ë–ü",
  "phone_number": "+7 999 123-45-67",
  "receipt": "data:application/pdf;base64,JVBERi0xLjQK...",
  "receipt_filename": "check.pdf"
}
```

–î–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã:
```json
{
  "method": "USDT TRC-20",
  "wallet_address": "TYN5CrEMj4hJcGpZHRq1qPgWwzfCVtJnEF",
  "transaction_hash": "0x1234567890abcdef...",
  "receipt": "data:image/jpeg;base64,/9j/4AAQSkZJRg...",
  "receipt_filename": "screenshot.jpg"
}
```

### 2. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏—è (`app/dashboard/deposit/page.tsx`)

#### –î–æ–±–∞–≤–∏—Ç—å State:
```typescript
const [receiptFile, setReceiptFile] = useState<File | null>(null)
const [receiptBase64, setReceiptBase64] = useState<string>("")
const [transactionHash, setTransactionHash] = useState<string>("")
```

#### –î–æ–±–∞–≤–∏—Ç—å –§—É–Ω–∫—Ü–∏—é –ó–∞–≥—Ä—É–∑–∫–∏:
```typescript
const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
  const file = e.target.files?.[0]
  if (!file) return

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ (5 –ú–ë)
  if (file.size > 5 * 1024 * 1024) {
    toast.error('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 5 –ú–ë)')
    return
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
  const allowedTypes = selectedMethod === 'crypto' 
    ? ['image/jpeg', 'image/jpg', 'image/png']
    : ['application/pdf']
  
  if (!allowedTypes.includes(file.type)) {
    toast.error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞')
    return
  }

  // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ Base64
  const reader = new FileReader()
  reader.onloadend = () => {
    setReceiptBase64(reader.result as string)
    setReceiptFile(file)
    toast.success('–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω')
  }
  reader.readAsDataURL(file)
}
```

#### –î–æ–±–∞–≤–∏—Ç—å UI –Ω–∞ –®–∞–≥–µ 3:
```tsx
{/* –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ–∫–∞ */}
<div className="space-y-4">
  <Label>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —á–µ–∫ –æ–± –æ–ø–ª–∞—Ç–µ</Label>
  <Input
    type="file"
    accept={selectedMethod === 'crypto' ? 'image/jpeg,image/jpg,image/png' : 'application/pdf'}
    onChange={handleFileUpload}
    className="bg-white/10 border-white/20 text-white"
  />
  {receiptFile && (
    <div className="text-green-400 text-sm">
      ‚úì –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω: {receiptFile.name}
    </div>
  )}
</div>

{/* –î–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã - –∞–¥—Ä–µ—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ */}
{selectedMethod === 'crypto' && (
  <div className="space-y-2">
    <Label>–ê–¥—Ä–µ—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (Transaction Hash)</Label>
    <Input
      value={transactionHash}
      onChange={(e) => setTransactionHash(e.target.value)}
      placeholder="0x1234567890abcdef..."
      className="bg-white/10 border-white/20 text-white font-mono"
    />
  </div>
)}
```

### 3. API Endpoint (`app/api/deposit/route.ts`)

–û–±–Ω–æ–≤–∏—Ç—å, —á—Ç–æ–±—ã –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —á–µ–∫:
```typescript
const paymentDetails: any = {
  method: methodName,
  receipt: body.receipt,
  receipt_filename: body.receipt_filename
}

if (payment_method === "crypto") {
  paymentDetails.transaction_hash = body.transaction_hash
  paymentDetails.wallet_address = body.wallet_address
}
```

### 4. –ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å (`app/admin/requests-simple/page.tsx`)

–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ–∫–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤:

```tsx
{/* –ß–µ–∫ –æ–± –æ–ø–ª–∞—Ç–µ */}
{selectedRequest.payment_details?.receipt && (
  <div className="space-y-2">
    <span className="text-gray-700 font-medium">üìÑ –ß–µ–∫ –æ–± –æ–ø–ª–∞—Ç–µ:</span>
    {selectedRequest.payment_details.receipt.startsWith('data:application/pdf') ? (
      <Button
        onClick={() => {
          const link = document.createElement('a')
          link.href = selectedRequest.payment_details.receipt
          link.download = selectedRequest.payment_details.receipt_filename || 'check.pdf'
          link.click()
        }}
        className="w-full"
      >
        üì• –°–∫–∞—á–∞—Ç—å PDF
      </Button>
    ) : (
      <img 
        src={selectedRequest.payment_details.receipt} 
        alt="–ß–µ–∫" 
        className="w-full rounded-lg border-2 border-gray-300"
      />
    )}
  </div>
)}

{/* –ê–¥—Ä–µ—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã */}
{selectedRequest.payment_details?.transaction_hash && (
  <div className="flex justify-between items-center p-3 bg-white/90 rounded-lg">
    <span className="text-gray-700 font-medium">üîó Transaction Hash:</span>
    <div className="flex items-center gap-2">
      <span className="text-gray-900 font-mono text-xs">
        {selectedRequest.payment_details.transaction_hash.substring(0, 20)}...
      </span>
      <Button
        size="sm"
        variant="ghost"
        onClick={() => copyToClipboard(selectedRequest.payment_details.transaction_hash)}
      >
        <Copy className="w-4 h-4" />
      </Button>
    </div>
  </div>
)}
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ú–æ–º–µ–Ω—Ç—ã

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–º–∞–∫—Å. 5 –ú–ë)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- Base64 —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –Ω–∞ ~33%
- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (S3, Cloudinary)
- –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ–º Base64 –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞):
–í–º–µ—Å—Ç–æ Base64 –≤ –ë–î:
1. –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã –≤ `/public/uploads/receipts/`
2. –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –ë–î —Ç–æ–ª—å–∫–æ –ø—É—Ç—å: `/uploads/receipts/receipt_123.pdf`
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É `multer` –∏–ª–∏ `formidable` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω (—ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç)
2. ‚è≥ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
3. ‚è≥ –û–±–Ω–æ–≤–∏—Ç—å API endpoint
4. ‚è≥ –û–±–Ω–æ–≤–∏—Ç—å –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
5. ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ß–µ–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Base64 –≤ –ø–æ–ª–µ `payment_details`
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å PDF –∏–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- –î–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è transaction hash
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ "–†–µ–∫–≤–∏–∑–∏—Ç—ã"

–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª —ç—Ç–æ —Å–µ–π—á–∞—Å?
