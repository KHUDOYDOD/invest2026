# ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –°–∏—Å—Ç–µ–º–∞ - –ü–æ–ª–Ω–æ—Å—Ç—å—é –†–∞–±–æ—Ç–∞–µ—Ç

## üéØ –ß—Ç–æ –°–¥–µ–ª–∞–Ω–æ

–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## üìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### 1. –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –ö–æ–¥—ã
- ‚úÖ –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—Ñ–æ—Ä–º–∞—Ç: `REF + 8 —Å–∏–º–≤–æ–ª–æ–≤`)
- ‚úÖ –ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–æ–ª–µ `referral_code` —Ç–∞–±–ª–∏—Ü—ã `users`
- ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞: `http://localhost:3000/register?ref=REFXXXXXXXX`

### 2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –°—Å—ã–ª–∫–µ
- ‚úÖ –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ –∫–æ–¥ —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–æ–ª–µ `referred_by`
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
- ‚úÖ –ï—Å–ª–∏ –∫–æ–¥ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç (–∫–æ–¥ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ö–æ–º–∏—Å—Å–∏–π
- ‚úÖ –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –¥–µ–ø–æ–∑–∏—Ç–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è 5% –∫–æ–º–∏—Å—Å–∏—è —Ä–µ—Ñ–µ—Ä–µ—Ä—É
- ‚úÖ –ö–æ–º–∏—Å—Å–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ –±–∞–ª–∞–Ω—Å—É —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ (`balance`)
- ‚úÖ –ö–æ–º–∏—Å—Å–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ –æ–±—â–µ–º—É –∑–∞—Ä–∞–±–æ—Ç–∫—É (`total_earned`)
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Ç–∏–ø–∞ `referral_bonus` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

### 4. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –†–µ—Ñ–µ—Ä–∞–ª–æ–≤ –≤ –õ–∏—á–Ω–æ–º –ö–∞–±–∏–Ω–µ—Ç–µ
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –∏ —Å—Å—ã–ª–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:
  - –í—Å–µ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
  - –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ —Å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
  - –ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º–∏
- ‚úÖ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- ‚úÖ –ö–Ω–æ–ø–∫–∏ –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö (Telegram, WhatsApp, Twitter)
- ‚úÖ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `users`
```sql
referral_code VARCHAR(50) UNIQUE  -- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
referred_by VARCHAR(50)           -- –ö–æ–¥ —Ä–µ—Ñ–µ—Ä–µ—Ä–∞ (–∫—Ç–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª)
total_earned NUMERIC(15,2)        -- –û–±—â–∏–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫ —Å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
```

### –¢–∞–±–ª–∏—Ü–∞ `transactions`
```sql
type = 'referral_bonus'  -- –¢–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –∫–æ–º–∏—Å—Å–∏–π
```

## üí∞ –£—Å–ª–æ–≤–∏—è –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ü—Ä–æ–≥—Ä–∞–º–º—ã

### –£—Ä–æ–≤–Ω–∏ –ö–æ–º–∏—Å—Å–∏–π
- **1-–π —É—Ä–æ–≤–µ–Ω—å**: 5% –æ—Ç –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **2-–π —É—Ä–æ–≤–µ–Ω—å**: 3% –æ—Ç –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π 2-–≥–æ —É—Ä–æ–≤–Ω—è (–ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- **3-–π —É—Ä–æ–≤–µ–Ω—å**: 2% –æ—Ç –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π 3-–≥–æ —É—Ä–æ–≤–Ω—è (–ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

### –ö–∞–∫ –†–∞–±–æ—Ç–∞–µ—Ç
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –∏ –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–¥ `REFABC12345`
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å B —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ —Å—Å—ã–ª–∫–µ `register?ref=REFABC12345`
3. –í –±–∞–∑–µ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è B —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `referred_by = 'REFABC12345'`
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å B –¥–µ–ª–∞–µ—Ç –¥–µ–ø–æ–∑–∏—Ç –Ω–∞ $1000
5. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ–¥–æ–±—Ä—è–µ—Ç –¥–µ–ø–æ–∑–∏—Ç
6. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é B –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è $1000 –Ω–∞ –±–∞–ª–∞–Ω—Å
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é A –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è $50 (5% –æ—Ç $1000) –Ω–∞ –±–∞–ª–∞–Ω—Å
   - –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è A —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è `total_earned` –Ω–∞ $50
   - –°–æ–∑–¥–∞–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Ç–∏–ø–∞ `referral_bonus` –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è A

## üîß API Endpoints

### GET `/api/user/referrals?userId={userId}`
–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "referralCode": "REFABC12345",
  "totalReferrals": 5,
  "totalEarned": 250.00,
  "totalInvested": 5000.00,
  "referrals": [
    {
      "id": 123,
      "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
      "email": "ivan@example.com",
      "registrationDate": "2025-01-14T10:00:00Z",
      "level": 1,
      "totalInvested": 1000.00,
      "earned": 50.00,
      "status": "active"
    }
  ]
}
```

### POST `/api/auth/register`
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–º –∫–æ–¥–æ–º

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "email": "user@example.com",
  "password": "password123",
  "fullName": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "country": "RU",
  "referralCode": "REFABC12345"  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
}
```

## üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
node check-referral-fields.js
```

### –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É
```bash
node test-complete-referral-flow.js
```

### –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ referred_by (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
```bash
node add-referred-by-field.js
```

## üé® –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ –†–µ—Ñ–µ—Ä–∞–ª–æ–≤
- **–ü—É—Ç—å**: `/dashboard/referrals`
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç**: `components/dashboard/referral-stats.tsx`
- **–°—Ç—Ä–∞–Ω–∏—Ü–∞**: `app/dashboard/referrals/page.tsx`

### –§—É–Ω–∫—Ü–∏–∏
- ‚úÖ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏
- ‚úÖ –®–∞—Ä–∏–Ω–≥ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –°–ø–∏—Å–æ–∫ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–π –¥–∏–∑–∞–π–Ω —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏

## üöÄ –ö–∞–∫ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –î–ª—è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
1. –ó–∞–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª "–†–µ—Ñ–µ—Ä–∞–ª—ã"
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
4. –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π —Å –¥—Ä—É–∑—å—è–º–∏
5. –ü–æ–ª—É—á–∞—Ç—å 5% –æ—Ç –∫–∞–∂–¥–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞ –¥—Ä—É–∑–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –î–ª—è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- –ö–æ–º–∏—Å—Å–∏–∏ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –¥–µ–ø–æ–∑–∏—Ç–æ–≤
- –ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
- –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `transactions`

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –¥–µ–ø–æ–∑–∏—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
- –ö–æ–º–∏—Å—Å–∏—è –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è 1-–≥–æ —É—Ä–æ–≤–Ω—è (–ø—Ä—è–º—ã–µ —Ä–µ—Ñ–µ—Ä–∞–ª—ã)
- –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (2-–π –∏ 3-–π —É—Ä–æ–≤–Ω–∏) –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–¢–ê–ï–¢

–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!
