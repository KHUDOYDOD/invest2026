<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∞–¥–º–∏–Ω –ª–æ–≥–∏–Ω–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê –¢–µ—Å—Ç –∞–¥–º–∏–Ω –ª–æ–≥–∏–Ω–∞</h1>
        <p>–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–º–æ–∂–µ—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏ –Ω–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É.</p>
        
        <form id="loginForm">
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" value="admin@example.com" required>
            </div>
            
            <div class="form-group">
                <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="password" value="admin123" required>
            </div>
            
            <button type="submit" id="loginBtn">üöÄ –¢–µ—Å—Ç –ª–æ–≥–∏–Ω–∞</button>
            <button type="button" id="clearBtn">üßπ –û—á–∏—Å—Ç–∏—Ç—å</button>
            <button type="button" id="clearCacheBtn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à</button>
        </form>
        
        <div id="result"></div>
    </div>

    <script>
        const form = document.getElementById('loginForm');
        const result = document.getElementById('result');
        const loginBtn = document.getElementById('loginBtn');
        const clearBtn = document.getElementById('clearBtn');
        const clearCacheBtn = document.getElementById('clearCacheBtn');

        function showResult(message, type = 'info') {
            result.innerHTML = message;
            result.className = `result ${type}`;
        }

        function clearResult() {
            result.innerHTML = '';
            result.className = 'result';
        }

        async function testLogin(email, password) {
            try {
                loginBtn.disabled = true;
                showResult('üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...', 'info');

                console.log('üîê Attempting login with:', email);
                
                const startTime = Date.now();
                
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    },
                    body: JSON.stringify({ email, password })
                });

                const endTime = Date.now();
                const duration = endTime - startTime;

                console.log('üìä Response status:', response.status);
                console.log('‚è±Ô∏è Request duration:', duration + 'ms');

                const data = await response.json();
                console.log('üì• Response data:', data);

                let resultMessage = `üìä –†–ï–ó–£–õ–¨–¢–ê–¢ –¢–ï–°–¢–ê:\\n\\n`;
                resultMessage += `üåê URL: ${response.url}\\n`;
                resultMessage += `üìà –°—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}\\n`;
                resultMessage += `‚è±Ô∏è –í—Ä–µ–º—è: ${duration}ms\\n`;
                resultMessage += `üìÖ –í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞: ${new Date().toLocaleString()}\\n\\n`;

                if (response.ok && data.success) {
                    resultMessage += `‚úÖ –£–°–ü–ï–•!\\n\\n`;
                    resultMessage += `üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${data.user.fullName}\\n`;
                    resultMessage += `üìß Email: ${data.user.email}\\n`;
                    resultMessage += `üé≠ –†–æ–ª—å: ${data.user.role}\\n`;
                    resultMessage += `üëë –ê–¥–º–∏–Ω: ${data.user.isAdmin ? '–î–∞' : '–ù–µ—Ç'}\\n`;
                    resultMessage += `üí∞ –ë–∞–ª–∞–Ω—Å: $${data.user.balance}\\n`;
                    resultMessage += `üîÑ –†–µ–¥–∏—Ä–µ–∫—Ç: ${data.redirect}\\n`;
                    resultMessage += `üé≠ –î–µ–º–æ —Ä–µ–∂–∏–º: ${data.isDemoMode ? '–î–∞' : '–ù–µ—Ç'}\\n\\n`;
                    resultMessage += `üéüÔ∏è –¢–æ–∫–µ–Ω: ${data.token.substring(0, 50)}...\\n`;
                    
                    showResult(resultMessage, 'success');
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    localStorage.setItem('authToken', data.token);
                    localStorage.setItem('adminAuth', 'true');
                    localStorage.setItem('adminUser', JSON.stringify(data.user));
                    
                } else {
                    resultMessage += `‚ùå –û–®–ò–ë–ö–ê!\\n\\n`;
                    resultMessage += `üö´ –°–æ–æ–±—â–µ–Ω–∏–µ: ${data.error || data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}\\n`;
                    resultMessage += `üìã –ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç:\\n${JSON.stringify(data, null, 2)}`;
                    
                    showResult(resultMessage, 'error');
                }

            } catch (error) {
                console.error('üí• Login error:', error);
                
                let errorMessage = `üí• –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê!\\n\\n`;
                errorMessage += `üö® –¢–∏–ø: ${error.name}\\n`;
                errorMessage += `üìù –°–æ–æ–±—â–µ–Ω–∏–µ: ${error.message}\\n`;
                errorMessage += `üìç –°—Ç–µ–∫: ${error.stack}\\n`;
                
                showResult(errorMessage, 'error');
            } finally {
                loginBtn.disabled = false;
            }
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            await testLogin(email, password);
        });

        clearBtn.addEventListener('click', () => {
            clearResult();
        });

        clearCacheBtn.addEventListener('click', () => {
            // –û—á–∏—â–∞–µ–º localStorage
            localStorage.clear();
            
            // –û—á–∏—â–∞–µ–º sessionStorage
            sessionStorage.clear();
            
            // –ü—ã—Ç–∞–µ–º—Å—è –æ—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }
            
            showResult('üßπ –ö—ç—à –æ—á–∏—â–µ–Ω! –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏.', 'success');
            
            setTimeout(() => {
                window.location.reload();
            }, 2000);
        });

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
        window.addEventListener('load', () => {
            const hasToken = localStorage.getItem('authToken');
            const hasAdminAuth = localStorage.getItem('adminAuth');
            
            if (hasToken || hasAdminAuth) {
                showResult(`‚ÑπÔ∏è –ù–ê–ô–î–ï–ù–´ –°–û–•–†–ê–ù–ï–ù–ù–´–ï –î–ê–ù–ù–´–ï:\\n\\n–¢–æ–∫–µ–Ω: ${hasToken ? '–ï—Å—Ç—å' : '–ù–µ—Ç'}\\n–ê–¥–º–∏–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: ${hasAdminAuth || '–ù–µ—Ç'}\\n\\n–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.`, 'info');
            }
        });
    </script>
</body>
</html>