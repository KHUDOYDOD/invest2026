"use strict";(()=>{var e={};e.id=3917,e.ids=[3917],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},57170:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>d,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>w,staticGenerationAsyncStorage:()=>l});var a=t(73278),o=t(45002),n=t(54877),i=t(42047),u=e([i]);i=(u.then?(await u)():u)[0];let c=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/withdrawal-requests/[id]/reject/route",pathname:"/api/admin/withdrawal-requests/[id]/reject",filename:"route",bundlePath:"app/api/admin/withdrawal-requests/[id]/reject/route"},resolvedPagePath:"C:\\Users\\x4539\\Downloads\\Invest2025-main\\Invest2025-main\\app\\api\\admin\\withdrawal-requests\\[id]\\reject\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:p,staticGenerationAsyncStorage:l,serverHooks:w}=c,h="/api/admin/withdrawal-requests/[id]/reject/route";function d(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:l})}s()}catch(e){s(e)}})},42047:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{POST:()=>d});var a=t(71309),o=t(67390),n=t.n(o),i=t(44819),u=e([i]);async function d(e,{params:r}){try{let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return a.NextResponse.json({error:"Unauthorized"},{status:401});let s=t.substring(7),o=n().verify(s,process.env.JWT_SECRET||"your-secret-key"),u=await (0,i.I)("SELECT role_id FROM users WHERE id = $1",[o.userId]);if(!u.rows[0]||1!==u.rows[0].role_id)return a.NextResponse.json({error:"Access denied"},{status:403});let{admin_comment:d}=await e.json(),c=r.id;if("3"===c||"4"===c)return a.NextResponse.json({success:!0,message:"Заявка отклонена (демо-режим)"});let p=await (0,i.I)(`UPDATE withdrawal_requests 
       SET status = 'rejected', 
           admin_comment = $1, 
           processed_at = NOW(),
           processed_by = $2
       WHERE id = $3`,[d||"Отклонено",o.userId,c]);if(0===p.rowCount)return a.NextResponse.json({error:"Заявка не найдена"},{status:404});return a.NextResponse.json({success:!0,message:"Заявка на вывод отклонена"})}catch(e){return console.error("Error rejecting withdrawal request:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}i=(u.then?(await u)():u)[0],s()}catch(e){s(e)}})},44819:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{I:()=>n});var a=t(8678),o=e([a]);a=(o.then?(await o)():o)[0];let i=process.env.POSTGRES_URL_NON_POOLING||process.env.DATABASE_URL||process.env.POSTGRES_URL;if(!i)throw Error("DATABASE_URL, POSTGRES_URL, or POSTGRES_URL_NON_POOLING must be set. Did you forget to provision a database?");let u=new a.Pool({connectionString:i,ssl:!!i?.includes("sslmode=require")&&{rejectUnauthorized:!1}});async function n(e,r){let t=await u.connect();try{return await t.query(e,r)}finally{t.release()}}s()}catch(e){s(e)}})}};var r=require("../../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[7787,4833,7390],()=>t(57170));module.exports=s})();