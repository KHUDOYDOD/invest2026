"use strict";(()=>{var e={};e.id=2295,e.ids=[2295],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},78335:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>d,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>E,staticGenerationAsyncStorage:()=>l});var o=t(73278),a=t(45002),i=t(54877),n=t(3343),u=e([n]);n=(u.then?(await u)():u)[0];let p=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/deposit-requests/[id]/approve/route",pathname:"/api/admin/deposit-requests/[id]/approve",filename:"route",bundlePath:"app/api/admin/deposit-requests/[id]/approve/route"},resolvedPagePath:"C:\\Users\\x4539\\Downloads\\Invest2025-main\\Invest2025-main\\app\\api\\admin\\deposit-requests\\[id]\\approve\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:E}=p,m="/api/admin/deposit-requests/[id]/approve/route";function d(){return(0,i.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:l})}s()}catch(e){s(e)}})},3343:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{POST:()=>d});var o=t(71309),a=t(67390),i=t.n(a),n=t(44819),u=e([n]);async function d(e,{params:r}){try{let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return o.NextResponse.json({error:"Unauthorized"},{status:401});let s=t.substring(7),a=i().verify(s,process.env.JWT_SECRET||"your-secret-key"),u=await (0,n.I)("SELECT role_id FROM users WHERE id = $1",[a.userId]);if(!u.rows[0]||1!==u.rows[0].role_id)return o.NextResponse.json({error:"Access denied"},{status:403});let{admin_comment:d}=await e.json(),p=r.id;if("1"===p||"2"===p)return o.NextResponse.json({success:!0,message:"Ð—Ð°ÑÐ²ÐºÐ° Ð¾Ð´Ð¾Ð±Ñ€ÐµÐ½Ð° (Ð´ÐµÐ¼Ð¾-Ñ€ÐµÐ¶Ð¸Ð¼)"});let c=await (0,n.I)(`UPDATE deposit_requests 
       SET status = 'approved', 
           admin_comment = $1, 
           processed_at = NOW(),
           processed_by = $2
       WHERE id = $3`,[d||"ÐžÐ´Ð¾Ð±Ñ€ÐµÐ½Ð¾",a.userId,p]);if(0===c.rowCount)return o.NextResponse.json({error:"Ð—Ð°ÑÐ²ÐºÐ° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°"},{status:404});let l=await (0,n.I)("SELECT user_id, amount FROM deposit_requests WHERE id = $1",[p]);if(l.rows[0]){await (0,n.I)("UPDATE users SET balance = balance + $1 WHERE id = $2",[l.rows[0].amount,l.rows[0].user_id]);let e=await (0,n.I)("SELECT referred_by FROM users WHERE id = $1",[l.rows[0].user_id]);if(e.rows.length>0&&e.rows[0].referred_by){let r=e.rows[0].referred_by,t=.05*parseFloat(l.rows[0].amount);console.log(`ðŸ’° Processing referral commission: ${t} for code ${r}`);let s=await (0,n.I)("SELECT id FROM users WHERE referral_code = $1",[r]);if(s.rows.length>0){let e=s.rows[0].id;await (0,n.I)("UPDATE users SET balance = balance + $1, total_earned = total_earned + $1 WHERE id = $2",[t,e]),await (0,n.I)(`INSERT INTO transactions (id, user_id, type, amount, status, description, created_at)
             VALUES (gen_random_uuid(), $1, 'referral_bonus', $2, 'completed', 'Ð ÐµÑ„ÐµÑ€Ð°Ð»ÑŒÐ½Ð°Ñ ÐºÐ¾Ð¼Ð¸ÑÑÐ¸Ñ (5% Ð¾Ñ‚ Ð´ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð°)', NOW())`,[e,t]),console.log(`âœ… Referral commission ${t} credited to user ${e}`)}}}return o.NextResponse.json({success:!0,message:"Ð—Ð°ÑÐ²ÐºÐ° Ð½Ð° Ð¿Ð¾Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð¾Ð´Ð¾Ð±Ñ€ÐµÐ½Ð°"})}catch(e){return console.error("Error approving deposit request:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}n=(u.then?(await u)():u)[0],s()}catch(e){s(e)}})},44819:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{I:()=>i});var o=t(8678),a=e([o]);o=(a.then?(await a)():a)[0];let n=process.env.POSTGRES_URL_NON_POOLING||process.env.DATABASE_URL||process.env.POSTGRES_URL;if(!n)throw Error("DATABASE_URL, POSTGRES_URL, or POSTGRES_URL_NON_POOLING must be set. Did you forget to provision a database?");let u=new o.Pool({connectionString:n,ssl:!!n?.includes("sslmode=require")&&{rejectUnauthorized:!1}});async function i(e,r){let t=await u.connect();try{return await t.query(e,r)}finally{t.release()}}s()}catch(e){s(e)}})}};var r=require("../../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[7787,4833,7390],()=>t(78335));module.exports=s})();