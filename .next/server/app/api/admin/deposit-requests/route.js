"use strict";(()=>{var e={};e.id=3053,e.ids=[3053],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},70198:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{originalPathname:()=>_,patchFetch:()=>d,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var a=t(73278),o=t(45002),n=t(54877),i=t(38064),u=e([i]);i=(u.then?(await u)():u)[0];let c=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/deposit-requests/route",pathname:"/api/admin/deposit-requests",filename:"route",bundlePath:"app/api/admin/deposit-requests/route"},resolvedPagePath:"C:\\Users\\x4539\\Downloads\\Invest2025-main\\Invest2025-main\\app\\api\\admin\\deposit-requests\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:m}=c,_="/api/admin/deposit-requests/route";function d(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}s()}catch(e){s(e)}})},38064:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{GET:()=>c,PUT:()=>l});var a=t(71309),o=t(64985),n=t(67390),i=t.n(n),u=e([o]);function d(e){let r=e.headers.get("authorization");if(!r||!r.startsWith("Bearer "))return null;let t=r.substring(7);try{let e=process.env.NEXTAUTH_SECRET||process.env.JWT_SECRET||"fallback_secret",r=i().verify(t,e);if("admin"!==r.role&&"super_admin"!==r.role)return null;return r}catch(e){return console.error("Admin token verification error:",e),null}}async function c(e){try{console.log("=== ADMIN GET DEPOSIT REQUESTS ===");let r=d(e);if(!r)return a.NextResponse.json({error:"Доступ запрещен"},{status:403});console.log("Admin verified:",r.email);let t=await (0,o.I)(`SELECT 
        dr.id,
        dr.user_id,
        dr.amount,
        dr.method,
        dr.payment_details,
        dr.status,
        dr.admin_comment,
        dr.created_at,
        dr.processed_at,
        dr.processed_by,
        u.full_name as user_name,
        u.email as user_email
      FROM deposit_requests dr
      LEFT JOIN users u ON dr.user_id = u.id
      ORDER BY dr.created_at DESC
      LIMIT 100`);console.log(`Found ${t.rows.length} deposit requests`);let s=t.rows.map(e=>{var r;return{id:e.id,userId:e.user_id,user_id:e.user_id,users:{id:e.user_id,full_name:e.user_name||"Неизвестный пользователь",email:e.user_email||""},userName:e.user_name||"Неизвестный пользователь",userEmail:e.user_email||"",amount:parseFloat(e.amount),method:({bank_card:"Банковская карта",crypto:"Криптовалюта",bank_transfer:"Банковский перевод",e_wallet:"Электронный кошелек",cash:"Наличные","Банковская карта":"Банковская карта","Система быстрых платежей":"СБП","USDT TRC-20":"USDT TRC-20"})[r=e.method]||r,paymentDetails:e.payment_details,payment_details:e.payment_details,status:e.status,adminComment:e.admin_comment,admin_comment:e.admin_comment,createdAt:e.created_at,created_at:e.created_at,processedAt:e.processed_at,processed_at:e.processed_at,processedBy:e.processed_by}});return a.NextResponse.json({success:!0,requests:s})}catch(e){return console.error("❌ Error fetching admin deposit requests:",e),a.NextResponse.json({error:"Ошибка получения заявок на пополнение",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function l(e){try{console.log("=== ADMIN UPDATE DEPOSIT REQUEST ===");let r=d(e);if(!r)return a.NextResponse.json({error:"Доступ запрещен"},{status:403});let{requestId:t,status:s,adminComment:n}=await e.json();if(!t||!s)return a.NextResponse.json({error:"Не указаны обязательные поля"},{status:400});console.log("Updating request:",t,"Status:",s);let i=await (0,o.I)(`UPDATE deposit_requests 
       SET status = $1, admin_comment = $2, processed_at = NOW(), processed_by = $3
       WHERE id = $4
       RETURNING *`,[s,n||null,r.userId,t]);if(0===i.rows.length)return a.NextResponse.json({error:"Заявка не найдена"},{status:404});return console.log("✅ Request updated successfully"),a.NextResponse.json({success:!0,message:"Заявка обновлена успешно",request:i.rows[0]})}catch(e){return console.error("❌ Error updating deposit request:",e),a.NextResponse.json({error:"Ошибка обновления заявки",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}o=(u.then?(await u)():u)[0],s()}catch(e){s(e)}})},64985:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{I:()=>n,d:()=>u});var a=t(8678),o=e([a]);a=(o.then?(await o)():o)[0];let i=process.env.POSTGRES_URL_NON_POOLING||process.env.DATABASE_URL||process.env.POSTGRES_URL;if(!i)throw Error("DATABASE_URL, POSTGRES_URL, or POSTGRES_URL_NON_POOLING must be set. Did you forget to provision a database?");let u=new a.Pool({connectionString:i,ssl:!!i?.includes("sslmode=require")&&{rejectUnauthorized:!1}});async function n(e,r){let t=await u.connect();try{return await t.query(e,r)}finally{t.release()}}s()}catch(e){s(e)}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[7787,4833,7390],()=>t(70198));module.exports=s})();