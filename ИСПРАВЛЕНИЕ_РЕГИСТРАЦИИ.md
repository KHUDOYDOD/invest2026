# Исправление регистрации

## Проблема
При нажатии на кнопку "Зарегистрироваться" ничего не происходит.

## Причина
Отсутствовал API endpoint для регистрации `/api/auth/register`.

## Решение

### Шаг 1: Добавьте поле password_hash в базу данных

Запустите файл:
```bash
add-password-field.bat
```

Этот скрипт:
- Добавит поле `password_hash` в таблицу `users`
- Установит временный пароль `123456` для существующих пользователей

### Шаг 2: Добавьте поля профиля (если еще не сделали)

Запустите файл:
```bash
add-profile-fields.bat
```

### Шаг 3: Перезапустите сервер

Если сервер разработки запущен, перезапустите его:
```bash
npm run dev
```

## Что было исправлено

✅ **Создан API endpoint** `/api/auth/register`
- Валидация всех полей формы
- Проверка уникальности email
- Хеширование пароля с помощью bcrypt
- Генерация реферального кода
- Создание пользователя в базе данных
- Автоматический вход после регистрации

✅ **Улучшены сообщения**
- Зеленое уведомление при успешной регистрации
- Красные уведомления при ошибках
- Автоматическое перенаправление в личный кабинет через 2 секунды

✅ **Обработка ошибок**
- Проверка формата email
- Проверка длины пароля (минимум 6 символов)
- Проверка совпадения паролей
- Проверка существующего email
- Подсветка полей с ошибками

## Тестирование

1. Откройте страницу регистрации: http://localhost:3000/register
2. Заполните все поля:
   - Полное имя: Иван Иванов
   - Email: test@example.com
   - Пароль: 123456
   - Подтверждение пароля: 123456
   - Страна: Россия
   - Согласие с условиями: ✓
3. Нажмите "Зарегистрироваться"
4. Должно появиться зеленое уведомление
5. Через 2 секунды вы будете перенаправлены в личный кабинет

## Возможные проблемы

### Ошибка "Пользователь с таким email уже существует"
- Используйте другой email
- Или удалите существующего пользователя из базы данных

### Ошибка подключения к базе данных
- Проверьте, что PostgreSQL запущен
- Проверьте DATABASE_URL в файле .env.local
- Убедитесь, что база данных существует

### Ошибка "password_hash column does not exist"
- Запустите скрипт add-password-field.bat
- Проверьте, что скрипт выполнился успешно

## Структура API

### POST /api/auth/register

**Request Body:**
```json
{
  "email": "user@example.com",
  "password": "password123",
  "fullName": "Иван Иванов",
  "country": "Россия"
}
```

**Success Response (200):**
```json
{
  "success": true,
  "message": "Регистрация успешна!",
  "user": {
    "id": 1,
    "email": "user@example.com",
    "fullName": "Иван Иванов",
    "role": "user",
    "referralCode": "REF12345678",
    "balance": 0
  },
  "token": "base64_token",
  "redirect": "/dashboard"
}
```

**Error Response (400):**
```json
{
  "success": false,
  "error": "Пользователь с таким email уже существует",
  "field": "email"
}
```

## Безопасность

✅ Пароли хешируются с помощью bcrypt (10 раундов)
✅ Email приводится к нижнему регистру
✅ Валидация всех входных данных
✅ Защита от SQL-инъекций (параметризованные запросы)
✅ Проверка уникальности email на уровне базы данных

## Следующие шаги

После успешной регистрации пользователь:
1. Автоматически авторизуется
2. Получает токен аутентификации
3. Перенаправляется в личный кабинет
4. Может начать инвестировать

Для выхода из системы используйте кнопку "Выход" в личном кабинете.
