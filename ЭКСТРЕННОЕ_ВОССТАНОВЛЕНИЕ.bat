@echo off
chcp 65001 >nul
echo ========================================
echo üö® –≠–ö–°–¢–†–ï–ù–ù–û–ï –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï VPS
echo ========================================
echo.

echo [1/6] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...
ping -n 2 130.49.213.197 >nul
if errorlevel 1 (
    echo ‚ùå VPS –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!
    pause
    exit /b 1
)
echo ‚úÖ VPS –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ ping

echo.
echo [2/6] –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ...
call npm run build
if errorlevel 1 (
    echo ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ!
    pause
    exit /b 1
)
echo ‚úÖ –ü—Ä–æ–µ–∫—Ç —Å–æ–±—Ä–∞–Ω

echo.
echo [3/6] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ VPS –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ PM2...
echo –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å VPS (12345678) –∫–æ–≥–¥–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–∞–ø—Ä–æ—Å:
ssh root@130.49.213.197 "cd /root/invest2026 && pm2 status && pm2 restart investpro || (echo 'PM2 –Ω–µ –∑–∞–ø—É—â–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º...' && NODE_OPTIONS='--max-old-space-size=768' pm2 start npm --name investpro --max-memory-restart 800M -- start)"

echo.
echo [4/6] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –Ω–∞ VPS...
echo –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å VPS –µ—â–µ —Ä–∞–∑:
ssh root@130.49.213.197 "cd /root/invest2026 && git pull origin main"

echo.
echo [5/6] –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞...
echo –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å VPS –µ—â–µ —Ä–∞–∑:
scp -r .next root@130.49.213.197:/root/invest2026/

echo.
echo [6/6] –§–∏–Ω–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫...
echo –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å VPS –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑:
ssh root@130.49.213.197 "cd /root/invest2026 && pm2 restart investpro && pm2 status"

echo.
echo ========================================
echo ‚úÖ –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û!
echo ========================================
echo.
echo üåê –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∞–π—Ç: http://130.49.213.197
echo.
pause