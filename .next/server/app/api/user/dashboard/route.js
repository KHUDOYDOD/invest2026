"use strict";(()=>{var e={};e.id=4403,e.ids=[4403],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:e=>{e.exports=import("pg")},42633:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{originalPathname:()=>m,patchFetch:()=>u,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>_,staticGenerationAsyncStorage:()=>p});var s=a(73278),o=a(45002),n=a(54877),i=a(46381),d=e([i]);i=(d.then?(await d)():d)[0];let l=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/user/dashboard/route",pathname:"/api/user/dashboard",filename:"route",bundlePath:"app/api/user/dashboard/route"},resolvedPagePath:"C:\\Users\\x4539\\Downloads\\Invest2025-main\\Invest2025-main\\app\\api\\user\\dashboard\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:_}=l,m="/api/user/dashboard/route";function u(){return(0,n.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:p})}r()}catch(e){r(e)}})},46381:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{POST:()=>i});var s=a(71309),o=a(64985),n=e([o]);async function i(e){try{let{userId:t}=await e.json();if(!t)return s.NextResponse.json({success:!1,error:"User ID обязателен"},{status:400});console.log("Loading dashboard data for user:",t);let a=await (0,o.I)(`SELECT id, email, full_name, balance, total_invested, total_earned, role_id, created_at
       FROM users WHERE id = $1`,[t]);if(0===a.rows.length)return s.NextResponse.json({success:!1,error:"Пользователь не найден"},{status:404});let r=a.rows[0],n=1===r.role_id,i=await (0,o.I)(`SELECT id, plan_name, amount, daily_profit, total_profit, start_date, end_date, status, progress, days_left, days_total
       FROM investments 
       WHERE user_id = $1
       ORDER BY start_date DESC`,[t]),d=await (0,o.I)(`SELECT id, type, amount, status, description, method, fee, final_amount, created_at
       FROM transactions 
       WHERE user_id = $1 
       ORDER BY created_at DESC 
       LIMIT 5`,[t]),u={id:r.id,name:r.full_name,email:r.email,balance:parseFloat(r.balance),totalInvested:parseFloat(r.total_invested),totalEarned:parseFloat(r.total_earned),isAdmin:n,joinDate:r.created_at};return console.log("Dashboard data loaded successfully for user:",r.email),s.NextResponse.json({success:!0,user:u,investments:i.rows,transactions:d.rows})}catch(e){return console.error("Dashboard API error:",e),s.NextResponse.json({success:!1,error:"Ошибка сервера"},{status:500})}}o=(n.then?(await n)():n)[0],r()}catch(e){r(e)}})},64985:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{I:()=>n,d:()=>d});var s=a(8678),o=e([s]);s=(o.then?(await o)():o)[0];let i=process.env.POSTGRES_URL_NON_POOLING||process.env.DATABASE_URL||process.env.POSTGRES_URL;if(!i)throw Error("DATABASE_URL, POSTGRES_URL, or POSTGRES_URL_NON_POOLING must be set. Did you forget to provision a database?");let d=new s.Pool({connectionString:i,ssl:!!i?.includes("sslmode=require")&&{rejectUnauthorized:!1}});async function n(e,t){let a=await d.connect();try{return await a.query(e,t)}finally{a.release()}}r()}catch(e){r(e)}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[7787,4833],()=>a(42633));module.exports=r})();