"use strict";(()=>{var e={};e.id=759,e.ids=[759],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},51229:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{originalPathname:()=>m,patchFetch:()=>l,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>E,staticGenerationAsyncStorage:()=>p});var n=a(73278),s=a(45002),i=a(54877),o=a(28527),u=e([o]);o=(u.then?(await u)():u)[0];let c=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/transactions/[id]/route",pathname:"/api/admin/transactions/[id]",filename:"route",bundlePath:"app/api/admin/transactions/[id]/route"},resolvedPagePath:"C:\\Users\\x4539\\Downloads\\Invest2025-main\\Invest2025-main\\app\\api\\admin\\transactions\\[id]\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:E}=c,m="/api/admin/transactions/[id]/route";function l(){return(0,i.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:p})}r()}catch(e){r(e)}})},28527:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{DELETE:()=>l,PUT:()=>u});var n=a(71309),s=a(64985),i=a(16910),o=e([s,i]);[s,i]=o.then?(await o)():o;let u=(0,i.kF)(async(e,{params:t})=>{try{let a=await e.json(),{id:r}=t,{type:i,amount:o,status:u,description:l}=a,c=(await (0,s.I)("SELECT * FROM transactions WHERE id = $1",[r])).rows[0];if(!c)return n.NextResponse.json({error:"Transaction not found"},{status:404});let d=await (0,s.I)(`UPDATE transactions 
       SET type = $1, amount = $2, status = $3, description = $4, updated_at = CURRENT_TIMESTAMP
       WHERE id = $5 RETURNING *`,[i,o,u,l,r]),p=c.status,E=c.user_id;return p!==u&&("completed"===p&&"completed"!==u?"deposit"===c.type?await (0,s.I)("UPDATE users SET balance = balance - $1 WHERE id = $2",[c.amount,E]):"withdrawal"===c.type&&await (0,s.I)("UPDATE users SET balance = balance + $1 WHERE id = $2",[c.amount,E]):"completed"!==p&&"completed"===u&&("deposit"===i?await (0,s.I)("UPDATE users SET balance = balance + $1 WHERE id = $2",[o,E]):"withdrawal"===i&&await (0,s.I)("UPDATE users SET balance = balance - $1 WHERE id = $2",[o,E]))),n.NextResponse.json(d.rows[0])}catch(e){return console.error("Error updating transaction:",e),n.NextResponse.json({error:"Failed to update transaction"},{status:500})}}),l=(0,i.kF)(async(e,{params:t})=>{try{let{id:e}=t,a=(await (0,s.I)("SELECT * FROM transactions WHERE id = $1",[e])).rows[0];if(!a)return n.NextResponse.json({error:"Transaction not found"},{status:404});return"completed"===a.status&&("deposit"===a.type?await (0,s.I)("UPDATE users SET balance = balance - $1 WHERE id = $2",[a.amount,a.user_id]):"withdrawal"===a.type&&await (0,s.I)("UPDATE users SET balance = balance + $1 WHERE id = $2",[a.amount,a.user_id])),await (0,s.I)("DELETE FROM transactions WHERE id = $1",[e]),n.NextResponse.json({success:!0})}catch(e){return console.error("Error deleting transaction:",e),n.NextResponse.json({error:"Failed to delete transaction"},{status:500})}});r()}catch(e){r(e)}})},16910:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{kF:()=>l});var n=a(67390),s=a.n(n),i=a(64985),o=e([i]);async function u(e){try{let t=e.cookies.get("auth-token")?.value;if(!t)return null;let a=s().verify(t,process.env.NEXTAUTH_SECRET||"fallback-secret");if(!a.userId)return null;let r=await (0,i.I)(`SELECT u.id, u.email, u.full_name, u.balance, u.total_invested, 
              u.total_earned, u.is_active, ur.name as role_name
       FROM users u
       LEFT JOIN user_roles ur ON u.role_id = ur.id
       WHERE u.id = $1 AND u.is_active = true`,[a.userId]);if(0===r.rows.length)return null;let n=r.rows[0];return{id:n.id,email:n.email,full_name:n.full_name,balance:n.balance,total_invested:n.total_invested,total_earned:n.total_earned,role:n.role_name,isAdmin:"admin"===n.role_name||"super_admin"===n.role_name}}catch(e){return console.error("Session error:",e),null}}function l(e){return async t=>{let a=await u(t);return a&&a.isAdmin?e(t,a):new Response(JSON.stringify({error:"Admin access required"}),{status:403,headers:{"Content-Type":"application/json"}})}}i=(o.then?(await o)():o)[0],r()}catch(e){r(e)}})},64985:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{I:()=>i,d:()=>u});var n=a(8678),s=e([n]);n=(s.then?(await s)():s)[0];let o=process.env.POSTGRES_URL_NON_POOLING||process.env.DATABASE_URL||process.env.POSTGRES_URL;if(!o)throw Error("DATABASE_URL, POSTGRES_URL, or POSTGRES_URL_NON_POOLING must be set. Did you forget to provision a database?");let u=new n.Pool({connectionString:o,ssl:!!o?.includes("sslmode=require")&&{rejectUnauthorized:!1}});async function i(e,t){let a=await u.connect();try{return await a.query(e,t)}finally{a.release()}}r()}catch(e){r(e)}})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[7787,4833,7390],()=>a(51229));module.exports=r})();