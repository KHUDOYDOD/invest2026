"use strict";(()=>{var e={};e.id=4698,e.ids=[4698],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},83983:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{originalPathname:()=>h,patchFetch:()=>l,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>d});var o=s(73278),a=s(45002),n=s(54877),i=s(29753),u=e([i]);i=(u.then?(await u)():u)[0];let c=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/deposit-requests/route",pathname:"/api/deposit-requests",filename:"route",bundlePath:"app/api/deposit-requests/route"},resolvedPagePath:"C:\\Users\\x4539\\Downloads\\Invest2025-main\\Invest2025-main\\app\\api\\deposit-requests\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:g}=c,h="/api/deposit-requests/route";function l(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:d})}r()}catch(e){r(e)}})},29753:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{POST:()=>l});var o=s(71309),a=s(64985),n=s(67390),i=s.n(n),u=e([a]);async function l(e){try{let t;console.log("=== DEPOSIT REQUEST DEBUG ===");let s=e.headers.get("authorization");if(console.log("Auth header:",s?"Present":"Missing"),!s||!s.startsWith("Bearer "))return console.log("❌ No valid auth header"),o.NextResponse.json({error:"No authorization header"},{status:401});let r=s.substring(7);console.log("Token length:",r.length),console.log("Token start:",r.substring(0,20)+"...");try{let e=process.env.NEXTAUTH_SECRET||process.env.JWT_SECRET||"fallback_secret";console.log("Using secret:",e.substring(0,10)+"..."),t=i().verify(r,e),console.log("✅ Token verified, user:",t)}catch(e){return console.log("❌ JWT verification failed:",e.message),o.NextResponse.json({error:"Invalid token: "+e.message},{status:401})}let{amount:n,method:u,paymentDetails:l}=await e.json();if(console.log("Request body:",{amount:n,method:u,paymentDetails:l}),!n||!u)return o.NextResponse.json({error:"Missing required fields"},{status:400});console.log("Creating deposit request for user:",t.userId,"Amount:",n,"Method:",u);let c=await (0,a.I)(`INSERT INTO deposit_requests (user_id, amount, method, payment_details, status, created_at)
       VALUES ($1, $2, $3, $4, 'pending', NOW())
       RETURNING *`,[t.userId,n,u,JSON.stringify(l)]);return console.log("✅ Deposit request created successfully:",c.rows[0]),o.NextResponse.json({success:!0,message:"Заявка на пополнение создана успешно",request:c.rows[0]},{status:201})}catch(e){return console.error("❌ Error creating deposit request:",e),o.NextResponse.json({error:"Failed to create deposit request: "+e.message},{status:500})}}a=(u.then?(await u)():u)[0],r()}catch(e){r(e)}})},64985:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.d(t,{I:()=>n,d:()=>u});var o=s(8678),a=e([o]);o=(a.then?(await a)():a)[0];let i=process.env.POSTGRES_URL_NON_POOLING||process.env.DATABASE_URL||process.env.POSTGRES_URL;if(!i)throw Error("DATABASE_URL, POSTGRES_URL, or POSTGRES_URL_NON_POOLING must be set. Did you forget to provision a database?");let u=new o.Pool({connectionString:i,ssl:!!i?.includes("sslmode=require")&&{rejectUnauthorized:!1}});async function n(e,t){let s=await u.connect();try{return await s.query(e,t)}finally{s.release()}}r()}catch(e){r(e)}})}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[7787,4833,7390],()=>s(83983));module.exports=r})();