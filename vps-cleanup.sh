#!/bin/bash

# ============================================
# –°–ö–†–ò–ü–¢ –û–ß–ò–°–¢–ö–ò –ú–ï–°–¢–ê –ù–ê VPS
# ============================================

echo "üßπ –ù–∞—á–∏–Ω–∞–µ–º –æ—á–∏—Å—Ç–∫—É –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ..."
echo ""

# –¶–≤–µ—Ç–∞
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m'

echo -e "${BLUE}üìä –ú–µ—Å—Ç–æ –î–û –æ—á–∏—Å—Ç–∫–∏:${NC}"
df -h / | grep -v Filesystem
echo ""

# –û—á–∏—Å—Ç–∫–∞ APT
echo -e "${GREEN}[1/7] –û—á–∏—Å—Ç–∫–∞ APT –∫—ç—à–∞...${NC}"
apt autoremove -y
apt clean
apt autoclean

# –û—á–∏—Å—Ç–∫–∞ –∂—É—Ä–Ω–∞–ª–æ–≤
echo -e "${GREEN}[2/7] –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤...${NC}"
journalctl --vacuum-time=3d

# –û—á–∏—Å—Ç–∫–∞ Snap
echo -e "${GREEN}[3/7] –û—á–∏—Å—Ç–∫–∞ Snap –∫—ç—à–∞...${NC}"
rm -rf /var/lib/snapd/cache/*

# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —è–¥–µ—Ä (–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–µ–µ –∏ –æ–¥–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–µ)
echo -e "${GREEN}[4/7] –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —è–¥–µ—Ä...${NC}"
dpkg -l 'linux-*' | sed '/^ii/!d;/'"$(uname -r | sed "s/\(.*\)-\([^0-9]\+\)/\1/")"'/d;s/^[^ ]* [^ ]* \([^ ]*\).*/\1/;/[0-9]/!d' | xargs apt-get -y purge 2>/dev/null || true

# –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
echo -e "${GREEN}[5/7] –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤...${NC}"
rm -rf /tmp/*
rm -rf /var/tmp/*

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤
echo -e "${GREEN}[6/7] –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤...${NC}"
find /var/log -type f -name "*.log" -mtime +7 -delete 2>/dev/null || true
find /var/log -type f -name "*.gz" -delete 2>/dev/null || true

# –û—á–∏—Å—Ç–∫–∞ npm –∫—ç—à–∞
echo -e "${GREEN}[7/7] –û—á–∏—Å—Ç–∫–∞ npm –∫—ç—à–∞...${NC}"
npm cache clean --force 2>/dev/null || true

echo ""
echo -e "${GREEN}‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!${NC}"
echo ""
echo -e "${BLUE}üìä –ú–µ—Å—Ç–æ –ü–û–°–õ–ï –æ—á–∏—Å—Ç–∫–∏:${NC}"
df -h / | grep -v Filesystem
echo ""
