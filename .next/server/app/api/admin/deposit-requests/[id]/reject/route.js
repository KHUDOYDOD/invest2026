"use strict";(()=>{var e={};e.id=5248,e.ids=[5248],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},1091:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{originalPathname:()=>R,patchFetch:()=>d,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var o=t(73278),a=t(45002),n=t(54877),i=t(82018),u=e([i]);i=(u.then?(await u)():u)[0];let p=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/deposit-requests/[id]/reject/route",pathname:"/api/admin/deposit-requests/[id]/reject",filename:"route",bundlePath:"app/api/admin/deposit-requests/[id]/reject/route"},resolvedPagePath:"C:\\Users\\x4539\\Downloads\\Invest2025-main\\Invest2025-main\\app\\api\\admin\\deposit-requests\\[id]\\reject\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:m}=p,R="/api/admin/deposit-requests/[id]/reject/route";function d(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}s()}catch(e){s(e)}})},82018:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{POST:()=>d});var o=t(71309),a=t(67390),n=t.n(a),i=t(44819),u=e([i]);async function d(e,{params:r}){try{let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return o.NextResponse.json({error:"Unauthorized"},{status:401});let s=t.substring(7),a=n().verify(s,process.env.JWT_SECRET||"your-secret-key"),u=await (0,i.I)("SELECT role_id FROM users WHERE id = $1",[a.userId]);if(!u.rows[0]||1!==u.rows[0].role_id)return o.NextResponse.json({error:"Access denied"},{status:403});let{admin_comment:d}=await e.json(),p=r.id;if("1"===p||"2"===p)return o.NextResponse.json({success:!0,message:"Заявка отклонена (демо-режим)"});let c=await (0,i.I)(`UPDATE deposit_requests 
       SET status = 'rejected', 
           admin_comment = $1, 
           processed_at = NOW(),
           processed_by = $2
       WHERE id = $3`,[d||"Отклонено",a.userId,p]);if(0===c.rowCount)return o.NextResponse.json({error:"Заявка не найдена"},{status:404});return o.NextResponse.json({success:!0,message:"Заявка на пополнение отклонена"})}catch(e){return console.error("Error rejecting deposit request:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}i=(u.then?(await u)():u)[0],s()}catch(e){s(e)}})},44819:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{I:()=>n});var o=t(8678),a=e([o]);o=(a.then?(await a)():a)[0];let i=process.env.POSTGRES_URL_NON_POOLING||process.env.DATABASE_URL||process.env.POSTGRES_URL;if(!i)throw Error("DATABASE_URL, POSTGRES_URL, or POSTGRES_URL_NON_POOLING must be set. Did you forget to provision a database?");let u=new o.Pool({connectionString:i,ssl:!!i?.includes("sslmode=require")&&{rejectUnauthorized:!1}});async function n(e,r){let t=await u.connect();try{return await t.query(e,r)}finally{t.release()}}s()}catch(e){s(e)}})}};var r=require("../../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[7787,4833,7390],()=>t(1091));module.exports=s})();