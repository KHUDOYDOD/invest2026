"use strict";(()=>{var e={};e.id=8430,e.ids=[8430],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},74619:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{originalPathname:()=>E,patchFetch:()=>l,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var s=r(73278),i=r(45002),n=r(54877),u=r(1801),o=e([u]);u=(o.then?(await o)():o)[0];let d=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/search/route",pathname:"/api/admin/search",filename:"route",bundlePath:"app/api/admin/search/route"},resolvedPagePath:"C:\\Users\\x4539\\Downloads\\Invest2025-main\\Invest2025-main\\app\\api\\admin\\search\\route.ts",nextConfigOutput:"",userland:u}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:m}=d,E="/api/admin/search/route";function l(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}a()}catch(e){a(e)}})},1801:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{GET:()=>l});var s=r(71309),i=r(64985),n=r(67390),u=r.n(n),o=e([i]);async function l(e){try{if(!function(e){let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return null;let r=t.substring(7);try{let e=process.env.NEXTAUTH_SECRET||process.env.JWT_SECRET||"fallback_secret",t=u().verify(r,e);if("admin"!==t.role&&"super_admin"!==t.role)return null;return t}catch(e){return console.error("Admin token verification error:",e),null}}(e))return s.NextResponse.json({error:"Доступ запрещен"},{status:403});let t=e.nextUrl.searchParams.get("q")||"";if(t.length<2)return s.NextResponse.json({results:[]});let r=[];(await (0,i.I)(`SELECT id, full_name, email, balance, created_at
       FROM users
       WHERE full_name ILIKE $1 OR email ILIKE $1
       LIMIT 5`,[`%${t}%`])).rows.forEach(e=>{r.push({id:`user-${e.id}`,type:"user",title:e.full_name||e.email,subtitle:`Email: ${e.email} • Баланс: $${parseFloat(e.balance).toFixed(2)}`,url:`/admin/users?id=${e.id}`})}),(await (0,i.I)(`SELECT wr.id, wr.amount, wr.status, wr.created_at, u.full_name, u.email
       FROM withdrawal_requests wr
       LEFT JOIN users u ON wr.user_id = u.id
       WHERE u.full_name ILIKE $1 OR u.email ILIKE $1 OR CAST(wr.amount AS TEXT) LIKE $1
       ORDER BY wr.created_at DESC
       LIMIT 5`,[`%${t}%`])).rows.forEach(e=>{r.push({id:`withdrawal-${e.id}`,type:"request",title:`Вывод $${parseFloat(e.amount).toFixed(2)}`,subtitle:`${e.full_name||e.email} • ${e.status} • ${new Date(e.created_at).toLocaleDateString("ru-RU")}`,url:`/admin/requests?type=withdrawal&id=${e.id}`})}),(await (0,i.I)(`SELECT dr.id, dr.amount, dr.status, dr.created_at, u.full_name, u.email
       FROM deposit_requests dr
       LEFT JOIN users u ON dr.user_id = u.id
       WHERE u.full_name ILIKE $1 OR u.email ILIKE $1 OR CAST(dr.amount AS TEXT) LIKE $1
       ORDER BY dr.created_at DESC
       LIMIT 5`,[`%${t}%`])).rows.forEach(e=>{r.push({id:`deposit-${e.id}`,type:"request",title:`Пополнение $${parseFloat(e.amount).toFixed(2)}`,subtitle:`${e.full_name||e.email} • ${e.status} • ${new Date(e.created_at).toLocaleDateString("ru-RU")}`,url:`/admin/requests?type=deposit&id=${e.id}`})}),(await (0,i.I)(`SELECT t.id, t.type, t.amount, t.status, t.created_at, u.full_name, u.email
       FROM transactions t
       LEFT JOIN users u ON t.user_id = u.id
       WHERE u.full_name ILIKE $1 OR u.email ILIKE $1 OR CAST(t.amount AS TEXT) LIKE $1
       ORDER BY t.created_at DESC
       LIMIT 5`,[`%${t}%`])).rows.forEach(e=>{r.push({id:`transaction-${e.id}`,type:"transaction",title:`${e.type} $${parseFloat(e.amount).toFixed(2)}`,subtitle:`${e.full_name||e.email} • ${e.status} • ${new Date(e.created_at).toLocaleDateString("ru-RU")}`,url:`/admin/transactions?id=${e.id}`})});let a=r.slice(0,10);return s.NextResponse.json({success:!0,results:a,total:r.length})}catch(e){return console.error("❌ Search error:",e),s.NextResponse.json({error:"Ошибка поиска",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}i=(o.then?(await o)():o)[0],a()}catch(e){a(e)}})},64985:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{I:()=>n,d:()=>o});var s=r(8678),i=e([s]);s=(i.then?(await i)():i)[0];let u=process.env.POSTGRES_URL_NON_POOLING||process.env.DATABASE_URL||process.env.POSTGRES_URL;if(!u)throw Error("DATABASE_URL, POSTGRES_URL, or POSTGRES_URL_NON_POOLING must be set. Did you forget to provision a database?");let o=new s.Pool({connectionString:u,ssl:!!u?.includes("sslmode=require")&&{rejectUnauthorized:!1}});async function n(e,t){let r=await o.connect();try{return await r.query(e,t)}finally{r.release()}}a()}catch(e){a(e)}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[7787,4833,7390],()=>r(74619));module.exports=a})();