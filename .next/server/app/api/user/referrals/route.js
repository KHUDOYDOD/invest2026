"use strict";(()=>{var e={};e.id=756,e.ids=[756],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:e=>{e.exports=import("pg")},96144:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{originalPathname:()=>E,patchFetch:()=>l,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>p});var s=t(73278),n=t(45002),o=t(54877),u=t(86472),i=e([u]);u=(i.then?(await i)():i)[0];let d=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/user/referrals/route",pathname:"/api/user/referrals",filename:"route",bundlePath:"app/api/user/referrals/route"},resolvedPagePath:"C:\\Users\\x4539\\Downloads\\Invest2025-main\\Invest2025-main\\app\\api\\user\\referrals\\route.ts",nextConfigOutput:"",userland:u}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:f}=d,E="/api/user/referrals/route";function l(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:p})}a()}catch(e){a(e)}})},86472:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{GET:()=>u});var s=t(71309),n=t(64985),o=e([n]);async function u(e){try{let{searchParams:r}=new URL(e.url),t=r.get("userId");if(!t)return s.NextResponse.json({success:!1,error:"User ID is required"},{status:400});let a=await n.d.connect();try{let e=await a.query("SELECT referral_code, total_earned FROM users WHERE id = $1",[t]);if(0===e.rows.length)return s.NextResponse.json({success:!1,error:"User not found"},{status:404});let r=e.rows[0],n=(await a.query(`SELECT 
          u.id,
          u.full_name as name,
          u.email,
          u.created_at as "registrationDate",
          u.total_invested as "totalInvested",
          u.status,
          COALESCE(
            (SELECT SUM(amount * 0.05) 
             FROM deposit_requests 
             WHERE user_id = u.id AND status = 'approved'),
            0
          ) as earned
        FROM users u
        WHERE u.referred_by = $1
        ORDER BY u.created_at DESC`,[r.referral_code])).rows.map((e,r)=>({id:e.id,name:e.name,email:e.email,registrationDate:e.registrationDate,level:1,totalInvested:parseFloat(e.totalInvested||0),earned:parseFloat(e.earned||0),status:e.status})),o=n.length,u=n.reduce((e,r)=>e+r.totalInvested,0),i=parseFloat(r.total_earned||0);return s.NextResponse.json({success:!0,referralCode:r.referral_code,totalReferrals:o,totalEarned:i,totalInvested:u,referrals:n})}finally{a.release()}}catch(e){return console.error("âŒ Error fetching referrals:",e),s.NextResponse.json({success:!1,error:e.message||"Failed to fetch referrals"},{status:500})}}n=(o.then?(await o)():o)[0],a()}catch(e){a(e)}})},64985:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.d(r,{I:()=>o,d:()=>i});var s=t(8678),n=e([s]);s=(n.then?(await n)():n)[0];let u=process.env.POSTGRES_URL_NON_POOLING||process.env.DATABASE_URL||process.env.POSTGRES_URL;if(!u)throw Error("DATABASE_URL, POSTGRES_URL, or POSTGRES_URL_NON_POOLING must be set. Did you forget to provision a database?");let i=new s.Pool({connectionString:u,ssl:!!u?.includes("sslmode=require")&&{rejectUnauthorized:!1}});async function o(e,r){let t=await i.connect();try{return await t.query(e,r)}finally{t.release()}}a()}catch(e){a(e)}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[7787,4833],()=>t(96144));module.exports=a})();