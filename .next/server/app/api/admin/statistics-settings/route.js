"use strict";(()=>{var e={};e.id=4919,e.ids=[4919],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},66250:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{originalPathname:()=>E,patchFetch:()=>u,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p});var o=t(73278),n=t(45002),a=t(54877),i=t(74914),c=e([i]);i=(c.then?(await c)():c)[0];let l=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/statistics-settings/route",pathname:"/api/admin/statistics-settings",filename:"route",bundlePath:"app/api/admin/statistics-settings/route"},resolvedPagePath:"C:\\Users\\x4539\\Downloads\\Invest2025-main\\Invest2025-main\\app\\api\\admin\\statistics-settings\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:g}=l,E="/api/admin/statistics-settings/route";function u(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:p})}r()}catch(e){r(e)}})},74914:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{GET:()=>u,PUT:()=>l});var o=t(71309),n=t(64985),a=t(67390),i=t.n(a),c=e([n]);async function u(e){try{let s;console.log("\uD83D\uDCCA Statistics Settings GET - Request received");let t=e.headers.get("authorization");console.log("Auth header:",t?"present":"missing");let r=null;if(t&&t.startsWith("Bearer ")&&(r=t.substring(7),console.log("Token extracted, length:",r.length)),!r)return console.error("❌ No token provided"),o.NextResponse.json({error:"Не авторизован"},{status:401});try{s=i().verify(r,process.env.NEXTAUTH_SECRET||process.env.JWT_SECRET||"fallback_secret"),console.log("✅ Token verified for user:",s.userId)}catch(e){return console.error("❌ Token verification failed:",e.message),o.NextResponse.json({error:"Недействительный токен"},{status:401})}let a=await (0,n.I)("SELECT role FROM users WHERE id = $1",[s.userId]);if(0===a.rows.length||"admin"!==a.rows[0].role)return console.error("❌ Access denied for user:",s.userId,"role:",a.rows[0]?.role),o.NextResponse.json({error:"Доступ запрещен"},{status:403});console.log("✅ Admin access granted"),console.log("Fetching settings from database...");let c=await (0,n.I)(`
      SELECT * FROM statistics_settings ORDER BY id DESC LIMIT 1
    `);if(console.log("Query result:",c.rows.length,"rows"),0===c.rows.length)return console.error("❌ No settings found in database"),o.NextResponse.json({error:"Настройки не найдены"},{status:404});return console.log("✅ Statistics settings loaded successfully"),o.NextResponse.json({success:!0,settings:c.rows[0]})}catch(e){return console.error("❌ Error fetching statistics settings:",e),o.NextResponse.json({error:"Ошибка получения настроек",details:e?.message||"Unknown error"},{status:500})}}async function l(e){try{let s;console.log("\uD83D\uDCCA Statistics Settings PUT - Request received");let t=e.headers.get("authorization"),r=null;if(t&&t.startsWith("Bearer ")&&(r=t.substring(7)),!r)return console.error("❌ No token provided"),o.NextResponse.json({error:"Не авторизован"},{status:401});try{s=i().verify(r,process.env.NEXTAUTH_SECRET||process.env.JWT_SECRET||"fallback_secret"),console.log("✅ Token verified for user:",s.userId)}catch(e){return console.error("❌ Token verification failed:",e.message),o.NextResponse.json({error:"Недействительный токен"},{status:401})}let a=await (0,n.I)("SELECT role FROM users WHERE id = $1",[s.userId]);if(0===a.rows.length||"admin"!==a.rows[0].role)return console.error("❌ Access denied for user:",s.userId),o.NextResponse.json({error:"Доступ запрещен"},{status:403});let{total_users:c,total_invested:u,total_paid:l,average_return:d,users_change:p,investments_change:g,payouts_change:E,profitability_change:R,use_real_data:h}=await e.json();console.log("Updating settings:",{total_users:c,total_invested:u,use_real_data:h});let f=await (0,n.I)(`UPDATE statistics_settings 
       SET 
         total_users = $1,
         total_invested = $2,
         total_paid = $3,
         average_return = $4,
         users_change = $5,
         investments_change = $6,
         payouts_change = $7,
         profitability_change = $8,
         use_real_data = $9,
         updated_at = NOW(),
         updated_by = $10
       WHERE id = (SELECT id FROM statistics_settings ORDER BY id DESC LIMIT 1)
       RETURNING *`,[c,u,l,d,p,g,E,R,h,s.userId]);return console.log(`✅ Statistics settings updated by admin ${s.userId}`),o.NextResponse.json({success:!0,message:"Настройки статистики обновлены",settings:f.rows[0]})}catch(e){return console.error("❌ Error updating statistics settings:",e),o.NextResponse.json({error:"Ошибка обновления настроек",details:e?.message||"Unknown error"},{status:500})}}n=(c.then?(await c)():c)[0],r()}catch(e){r(e)}})},64985:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.d(s,{I:()=>a,d:()=>c});var o=t(8678),n=e([o]);o=(n.then?(await n)():n)[0];let i=process.env.POSTGRES_URL_NON_POOLING||process.env.DATABASE_URL||process.env.POSTGRES_URL;if(!i)throw Error("DATABASE_URL, POSTGRES_URL, or POSTGRES_URL_NON_POOLING must be set. Did you forget to provision a database?");let c=new o.Pool({connectionString:i,ssl:!!i?.includes("sslmode=require")&&{rejectUnauthorized:!1}});async function a(e,s){let t=await c.connect();try{return await t.query(e,s)}finally{t.release()}}r()}catch(e){r(e)}})}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[7787,4833,7390],()=>t(66250));module.exports=r})();