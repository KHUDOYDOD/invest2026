# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –í–•–û–î–ê –ü–û–°–õ–ï –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤–æ–π—Ç–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ "–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å", —Ö–æ—Ç—è –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ.

## –ü—Ä–∏—á–∏–Ω–∞
API –≤—Ö–æ–¥–∞ (`/api/auth/login`) –∏—Å–∫–∞–ª –ø–æ–ª—è `role_id` –∏ `role_name` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `user_roles`, –∫–æ—Ç–æ—Ä–æ–π –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–µ –ø–æ–ª–µ `role`.

## –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. API –≤—Ö–æ–¥–∞ (`app/api/auth/login/route.ts`)

**–ë—ã–ª–æ:**
```typescript
SELECT 
  u.id,
  u.email,
  u.full_name,
  u.password_hash,
  u.role_id,
  u.status,
  ur.name as role_name
FROM users u
LEFT JOIN user_roles ur ON u.role_id = ur.id
WHERE u.email = $1 AND u.is_active = true
```

**–°—Ç–∞–ª–æ:**
```typescript
SELECT 
  id,
  email,
  full_name,
  password_hash,
  role,
  status
FROM users
WHERE email = $1 AND status = 'active'
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞

**–ë—ã–ª–æ:**
```typescript
role: user.role_name || 'user'
isAdmin: user.role_id <= 2
```

**–°—Ç–∞–ª–æ:**
```typescript
role: user.role || 'user'
isAdmin: user.role === 'admin' || user.role === 'super_admin'
```

### 3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞

**–ë—ã–ª–æ:**
```typescript
if (user.role_id === 1 || user.role_name === 'super_admin') {
  redirectUrl = '/admin/dashboard'
} else if (user.role_id === 2 || user.role_name === 'admin') {
  redirectUrl = '/admin/dashboard'
}
```

**–°—Ç–∞–ª–æ:**
```typescript
if (user.role === 'admin' || user.role === 'super_admin') {
  redirectUrl = '/admin/dashboard'
} else {
  redirectUrl = '/dashboard'
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
node test-login.js <email> <–ø–∞—Ä–æ–ª—å>
```

–ü—Ä–∏–º–µ—Ä:
```bash
node test-login.js admin@admin.admin admin123
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:
```
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω
‚úÖ –ü–∞—Ä–æ–ª—å –ü–†–ê–í–ò–õ–¨–ù–´–ô!
‚úÖ –í—Ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å!
```

### –¢–µ—Å—Ç 2: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥

1. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `/register`
   - –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
     - Email: `test@test.test`
     - –ü–∞—Ä–æ–ª—å: `test123`
     - –ò–º—è: `Test User`
     - –°—Ç—Ä–∞–Ω–∞: –ª—é–±–∞—è
   - –ù–∞–∂–º–∏—Ç–µ "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"

2. **–í—ã–π–¥–∏—Ç–µ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞:**
   - –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–í—ã–π—Ç–∏"

3. **–í–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `/login`
   - –í–≤–µ–¥–∏—Ç–µ:
     - Email: `test@test.test`
     - –ü–∞—Ä–æ–ª—å: `test123`
   - –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏"
   - ‚úÖ –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å!

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å
```bash
node reset-password.js <email> <–Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å>
```

–ü—Ä–∏–º–µ—Ä:
```bash
node reset-password.js salamoni@salamoni.salamoni newpass123
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å
```bash
node test-login.js <email> <–ø–∞—Ä–æ–ª—å>
```

–ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, —Å–±—Ä–æ—Å—å—Ç–µ –µ–≥–æ.

## –ì–æ—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–ª—è –≤—Ö–æ–¥–∞

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```
Email: admin@admin.admin
–ü–∞—Ä–æ–ª—å: admin123
–†–æ–ª—å: admin
```

### –î—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
–ï—Å–ª–∏ –∑–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
```bash
node reset-password.js <email> <–Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å>
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚úÖ User found: <email>
‚úÖ Password valid
‚úÖ Token created
‚úÖ Login successful
```

–í–º–µ—Å—Ç–æ:
```
‚ùå User not found (role_id column missing)
```

## –ì–æ—Ç–æ–≤–æ! ‚úÖ

–¢–µ–ø–µ—Ä—å:
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –í—Ö–æ–¥ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü–∞—Ä–æ–ª–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤–æ–π—Ç–∏! üéâ
